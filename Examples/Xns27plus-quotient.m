// Script provided by Jeremy Rouse

// This Magma script contains a model, maps, and points associated with the
// genus 3 curve X_H' defined over Q(zeta_3) that factors the map
// from X_ns^+(27) to X_ns^+(9). 

K<zeta> := CyclotomicField(3);
R<a,b,c> := PolynomialRing(K,3);
// Polynomial defining the genus 3 curve
f := a^4 + (zeta - 1)*a^3*b + (3*zeta + 2)*a^3*c - 3*a^2*c^2 + (2*zeta + 2)*a*b^3 - 3*zeta*a*b^2*c + 3*zeta*a*b*c^2 - 2*zeta*a*c^3 - zeta*b^3*c + 3*zeta*b^2*c^2 + (-zeta + 1)*b*c^3 + (zeta + 1)*c^4;
P2 := ProjectiveSpace(K,2);
C<a,b,c> := Curve(P2,f);

// The 13 points we've found on C are below. Their images on the j-line are given.

pt1 := C![0,1,0]; // j = 1728, D = -4
pt2 := C![zeta+1,1,0]; // j = 287496, D = -16 
pt3 := C![-zeta-1,0,1]; // j = 1728, D = -4
pt4 := C![-zeta-1,1,1]; // j = -884736000, D = -43
pt5 := C![-zeta-1,zeta+1,1]; // j = 1728, D = -4
pt6 := C![-zeta,0,1]; // j = -3375, D = -7
pt7 := C![0,zeta+1,1]; // j = -884736, D = -19
pt8 := C![zeta,2*zeta+2,1]; // j = 16581375, D = -28
pt9 := C![1,zeta,1]; // j = 1728, D = -4
pt10 := C![(1/2)*(zeta+2),(1/2)*(zeta-3),1]; // j = (-3238903991430*zeta - 4786881515880)^3/19^27, non-CM
pt11 := C![(1/3)*(zeta+2),(1/3)*(-zeta-2),1]; // j = -147197952000, D = -67
pt12 := C![-1/2,(-1/2)*zeta,1]; // j = 1728, D = -4
pt13 := C![-1,(1/7)*(5*zeta+4),1]; // j=-262737412640768000, D = -163

// pt1 + pt3 + pt5 - 2*pt9 - pt12 = 0 in the Jacobian.
// pt3 - pt7 + pt6 - pt9 has order 3 on the Jacobian.

// The formulas below give the map to the j-line.

E4elt := (1/2549187*(871163*zeta + 938255)*a^8 + 1/17844309*(-51795717*zeta + 
18683114)*a^7*b + 1/17844309*(23768554*zeta - 13740352)*a^7*c + 
1/17844309*(88955809*zeta + 88799162)*a^6*b^2 + 1/1982701*(1797202*zeta + 
10905893)*a^6*b*c + 1/17844309*(-40377811*zeta - 64070549)*a^6*c^2 + 
1/2549187*(42190307*zeta + 13100666)*a^5*b^3 + 1/17844309*(108008177*zeta + 
315659035)*a^5*b^2*c + 1/17844309*(55209461*zeta - 33802697)*a^5*b*c^2 + 
1/17844309*(-32390984*zeta - 967485)*a^5*c^3 + 1/17844309*(258239890*zeta - 
123770862)*a^4*b^4 + 1/17844309*(6256358*zeta + 170898862)*a^4*b^3*c + 
1/2549187*(30521567*zeta - 2183732)*a^4*b^2*c^2 + 1/17844309*(-27914226*zeta - 
58987858)*a^4*b*c^3 + 1/17844309*(91355864*zeta - 6084823)*a^3*b^5 + 
1/2549187*(-83032072*zeta - 25312295)*a^3*b^4*c + 1/5948103*(67769384*zeta - 
145850706)*a^3*b^3*c^2 + 1/17844309*(-100648270*zeta + 1374328)*a^3*b^2*c^3 + 
1/5948103*(156910182*zeta + 53189888)*a^2*b^6 + 1/17844309*(-695737775*zeta + 
405420095)*a^2*b^5*c + 1/17844309*(7873525*zeta - 950092546)*a^2*b^4*c^2 + 
1/17844309*(10803148*zeta + 393444221)*a^2*b^3*c^3 + 1/17844309*(183294256*zeta 
- 124081604)*a*b^7 + 1/849729*(1705864*zeta + 31273412)*a*b^6*c + 
1/17844309*(-215977232*zeta - 1074591136)*a*b^5*c^2 + 1/17844309*(433963408*zeta
+ 757018408)*a*b^4*c^3 + 1/17844309*(2427672*zeta + 1672240)*b^8 + 
1/17844309*(53501464*zeta + 145487408)*b^7*c + 1/2549187*(-36813704*zeta - 
72747112)*b^6*c^2 + 1/17844309*(368425528*zeta + 322136328)*b^5*c^3)/(a^6 - 
1624782/283243*a^5*b + 1008922/283243*a^5*c + 1/5948103*(-10738499*zeta + 
16457753)*a^4*b^2 + 1/5948103*(-16758790*zeta - 18023525)*a^4*b*c + 
1/283243*(1157164*zeta + 1921681)*a^4*c^2 + 1/5948103*(33658907*zeta + 
37745767)*a^3*b^3 + 1/5948103*(-62712856*zeta - 135930299)*a^3*b^2*c + 
1/5948103*(28866805*zeta + 86252960)*a^3*b*c^2 + 1/849729*(3450689*zeta + 
616210)*a^3*c^3 + 1/5948103*(-12679442*zeta - 10954204)*a^2*b^4 + 
1/1982701*(6013449*zeta - 2608447)*a^2*b^3*c + 1/1982701*(-29507015*zeta - 
18207331)*a^2*b^2*c^2 + 1/5948103*(40778588*zeta + 27200620)*a^2*b*c^3 + 
1/283243*(-34234*zeta - 210816)*a*b^5 + 1/5948103*(96888772*zeta + 
66916421)*a*b^4*c + 1/1982701*(-43242830*zeta - 37538289)*a*b^3*c^2 + 
1/849729*(5687852*zeta + 7505617)*a*b^2*c^3 + 1/5948103*(-3183104*zeta - 
4099912)*b^6 + 1/5948103*(16541122*zeta + 29976899)*b^5*c + 
1/5948103*(-14198095*zeta - 35465573)*b^4*c^2 + 1/5948103*(9685861*zeta - 
5879446)*b^3*c^3);
E6elt := (1/124399*(267219*zeta + 115323)*a^10 + 1/124399*(5413916*zeta + 
4653667)*a^9*b + 1/124399*(-126605*zeta - 677683)*a^9*c + 
1/124399*(-5145825*zeta - 14900778)*a^8*b^2 + 1/124399*(11861595*zeta - 
1361073)*a^8*b*c + 1/124399*(-1303737*zeta - 192699)*a^8*c^2 + 
1/124399*(407881*zeta + 2920325)*a^7*b^3 + 1/124399*(-10134234*zeta - 
3104577)*a^7*b^2*c + 1/124399*(-4689144*zeta - 11553993)*a^7*b*c^2 + 
1/124399*(91160*zeta + 869110)*a^7*c^3 + 1/124399*(-6397987*zeta - 
10477427)*a^6*b^4 + 1/124399*(25668804*zeta + 6691296)*a^6*b^3*c + 
1/124399*(15191529*zeta + 7108299)*a^6*b^2*c^2 + 1/124399*(-5299802*zeta - 
2604787)*a^6*b*c^3 + 1/124399*(-11483817*zeta - 25929525)*a^5*b^5 + 
1/124399*(40296708*zeta + 12304464)*a^5*b^4*c + 1/124399*(4952559*zeta + 
12697902)*a^5*b^3*c^2 + 1/124399*(-860178*zeta - 10026570)*a^5*b^2*c^3 + 
1/124399*(-5009936*zeta + 31246256)*a^4*b^6 + 1/124399*(-6680814*zeta + 
2458239)*a^4*b^5*c + 1/124399*(41311122*zeta + 78574629)*a^4*b^4*c^2 + 
1/124399*(-28520143*zeta - 23651387)*a^4*b^3*c^3 + 1/124399*(48888218*zeta + 
73457674)*a^3*b^7 + 1/124399*(-29097165*zeta + 8122572)*a^3*b^6*c + 
1/124399*(114434085*zeta + 184576413)*a^3*b^5*c^2 + 1/124399*(-57800786*zeta - 
58337923)*a^3*b^4*c^3 + 1/124399*(-51103914*zeta + 4362429)*a^2*b^8 + 
1/124399*(1985310*zeta - 112242657)*a^2*b^7*c + 1/124399*(162468057*zeta + 
244252422)*a^2*b^6*c^2 + 1/124399*(-89178795*zeta - 103008462)*a^2*b^5*c^3 + 
1/124399*(-30939038*zeta + 36187382)*a*b^9 + 1/124399*(-67124082*zeta - 
152643462)*a*b^8*c + 1/124399*(106478544*zeta + 216552462)*a*b^7*c^2 + 
1/124399*(-123430552*zeta - 149669834)*a*b^6*c^3 + 1/124399*(-17335168*zeta - 
33069080)*b^9*c + 1/124399*(64244448*zeta + 105164376)*b^8*c^2 + 
1/124399*(-88103768*zeta - 59058064)*b^7*c^3)/(a^7 - 9847076/124399*a^6*b + 
3056316/124399*a^6*c + 16703498/124399*a^5*b^2 + 1/124399*(-17360244*zeta - 
30827655)*a^5*b*c + 1/124399*(3691226*zeta + 5062654)*a^5*c^2 + 
1/124399*(-993301*zeta + 632535)*a^4*b^3 + 1/124399*(-12805555*zeta - 
31958006)*a^4*b^2*c + 1/124399*(-24551466*zeta - 2758005)*a^4*b*c^2 + 
1/124399*(161846*zeta - 502615)*a^4*c^3 + 1/124399*(-16290187*zeta - 
33466023)*a^3*b^4 + 1/124399*(53091881*zeta + 48284869)*a^3*b^3*c + 
1/124399*(-69912646*zeta - 57230036)*a^3*b^2*c^2 + 1/124399*(-5212595*zeta + 
14602179)*a^3*b*c^3 + 1/124399*(5415598*zeta - 10837775)*a^2*b^5 + 
1/124399*(23022078*zeta + 26496135)*a^2*b^4*c + 1/124399*(-19343180*zeta - 
52055329)*a^2*b^3*c^2 + 1/124399*(-16711720*zeta + 13158207)*a^2*b^2*c^3 + 
1/124399*(14545420*zeta + 8590176)*a*b^6 + 1/11309*(-2642209*zeta - 
25697)*a*b^5*c + 1/124399*(36565161*zeta - 7889325)*a*b^4*c^2 + 
1/124399*(-22492934*zeta - 13823643)*a*b^3*c^3 + 1/124399*(352524*zeta + 
1011364)*b^7 + 1/124399*(-4924166*zeta - 4535806)*b^6*c + 
1/124399*(11688169*zeta + 4882661)*b^5*c^2 + 1/124399*(-1767594*zeta + 
985657)*b^4*c^3);

jcanring := (1728*E4elt^3)/(E4elt^3 - E6elt^2);
jmap := map<C -> ProjectiveSpace(K,1) | [Numerator(jcanring),Denominator(jcanring)]>;


